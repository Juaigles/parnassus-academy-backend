# ğŸ—ï¸ ARQUITECTURA DEL SISTEMA
# PARNASSUS ACADEMY BACKEND - DocumentaciÃ³n de Arquitectura

## ğŸ“Š VISIÃ“N GENERAL DEL SISTEMA

### Arquitectura de Alto Nivel
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INTERNET                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CLOUDFLARE / CDN                               â”‚
â”‚              SSL Termination + DDoS Protection                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 NGINX LOAD BALANCER                             â”‚
â”‚       Rate Limiting + SSL + Static Files + Compression          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NODE.JS    â”‚ â”‚   NODE.JS    â”‚ â”‚   NODE.JS    â”‚
â”‚  INSTANCE 1  â”‚ â”‚  INSTANCE 2  â”‚ â”‚  INSTANCE 3  â”‚
â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ Express.js   â”‚ â”‚ Express.js   â”‚ â”‚ Express.js   â”‚
â”‚ Socket.io    â”‚ â”‚ Socket.io    â”‚ â”‚ Socket.io    â”‚
â”‚ JWT Auth     â”‚ â”‚ JWT Auth     â”‚ â”‚ JWT Auth     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚           SHARED SERVICES          â”‚
      â”‚                                   â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
      â”‚  â”‚        MONGODB              â”‚  â”‚
      â”‚  â”‚     (Replica Set)           â”‚  â”‚
      â”‚  â”‚                             â”‚  â”‚
      â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
      â”‚  â”‚  â”‚Primary  â”‚ â”‚Secondaryâ”‚   â”‚  â”‚
      â”‚  â”‚  â”‚         â”‚ â”‚         â”‚   â”‚  â”‚
      â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
      â”‚                                   â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
      â”‚  â”‚         REDIS               â”‚  â”‚
      â”‚  â”‚    (Session Store +         â”‚  â”‚
      â”‚  â”‚     Cache Layer)            â”‚  â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
      â”‚                                   â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
      â”‚  â”‚      EXTERNAL APIS          â”‚  â”‚
      â”‚  â”‚                             â”‚  â”‚
      â”‚  â”‚  â€¢ Stripe (Payments)        â”‚  â”‚
      â”‚  â”‚  â€¢ SendGrid (Email)         â”‚  â”‚
      â”‚  â”‚  â€¢ Mixpanel (Analytics)     â”‚  â”‚
      â”‚  â”‚  â€¢ AWS S3 (File Storage)    â”‚  â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ARQUITECTURA DE APLICACIÃ“N

### Estructura de Capas
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PRESENTATION LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚    ROUTES    â”‚  â”‚ MIDDLEWARES  â”‚  â”‚  WEBSOCKETS  â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ â€¢ /api/auth  â”‚  â”‚ â€¢ authJWT    â”‚  â”‚ â€¢ Realtime   â”‚          â”‚
â”‚  â”‚ â€¢ /api/user  â”‚  â”‚ â€¢ rateLimiterâ”‚  â”‚ â€¢ Broadcast  â”‚          â”‚
â”‚  â”‚ â€¢ /api/courseâ”‚  â”‚ â€¢ validator  â”‚  â”‚ â€¢ Rooms      â”‚          â”‚
â”‚  â”‚ â€¢ /api/pay   â”‚  â”‚ â€¢ security   â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ â€¢ /health    â”‚  â”‚ â€¢ cors       â”‚  â”‚              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      BUSINESS LOGIC LAYER                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ CONTROLLERS  â”‚  â”‚   SERVICES   â”‚  â”‚   UTILITIES  â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ â€¢ authCtrl   â”‚  â”‚ â€¢ authSvc    â”‚  â”‚ â€¢ emailUtil  â”‚          â”‚
â”‚  â”‚ â€¢ userCtrl   â”‚  â”‚ â€¢ userSvc    â”‚  â”‚ â€¢ cryptoUtil â”‚          â”‚
â”‚  â”‚ â€¢ courseCtrl â”‚  â”‚ â€¢ courseSvc  â”‚  â”‚ â€¢ fileUtil   â”‚          â”‚
â”‚  â”‚ â€¢ payCtrl    â”‚  â”‚ â€¢ paySvc     â”‚  â”‚ â€¢ cacheUtil  â”‚          â”‚
â”‚  â”‚ â€¢ adminCtrl  â”‚  â”‚ â€¢ adminSvc   â”‚  â”‚ â€¢ validUtil  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        DATA ACCESS LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ REPOSITORIES â”‚  â”‚    MODELS    â”‚  â”‚   DATABASE   â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ â€¢ userRepo   â”‚  â”‚ â€¢ User       â”‚  â”‚ â€¢ MongoDB    â”‚          â”‚
â”‚  â”‚ â€¢ courseRepo â”‚  â”‚ â€¢ Course     â”‚  â”‚ â€¢ Mongoose   â”‚          â”‚
â”‚  â”‚ â€¢ payRepo    â”‚  â”‚ â€¢ Purchase   â”‚  â”‚ â€¢ Indexes    â”‚          â”‚
â”‚  â”‚ â€¢ cacheRepo  â”‚  â”‚ â€¢ Progress   â”‚  â”‚ â€¢ Validation â”‚          â”‚
â”‚  â”‚              â”‚  â”‚ â€¢ Analytics  â”‚  â”‚ â€¢ Migrations â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ FLUJO DE DATOS

### Flujo de AutenticaciÃ³n
```mermaid
sequenceDiagram
    participant C as Cliente
    participant N as Nginx
    participant A as API Server
    participant DB as MongoDB
    participant R as Redis

    C->>N: POST /api/auth/login
    N->>A: Forward request
    A->>A: Validate input
    A->>DB: Query user by email
    DB->>A: Return user data
    A->>A: Verify password (bcrypt)
    A->>A: Generate JWT tokens
    A->>R: Store refresh token
    A->>A: Set httpOnly cookies
    A->>N: Return tokens + user data
    N->>C: Set-Cookie + JSON response
```

### Flujo de Compra
```mermaid
sequenceDiagram
    participant C as Cliente
    participant A as API Server
    participant S as Stripe
    participant DB as MongoDB
    participant WS as WebSocket

    C->>A: POST /api/payments/create-intent
    A->>DB: Validate course + user
    A->>S: Create PaymentIntent
    S->>A: Return client_secret
    A->>C: Return client_secret

    C->>S: Confirm payment (client-side)
    S->>A: Webhook: payment_succeeded
    A->>A: Verify webhook signature
    A->>DB: Create purchase record
    A->>DB: Update user course access
    A->>WS: Broadcast course_purchased
    A->>S: Return 200 OK
```

### Flujo de Progreso del Curso
```mermaid
sequenceDiagram
    participant C as Cliente
    participant A as API Server
    participant DB as MongoDB
    participant Cache as Redis
    participant Analytics as Mixpanel

    C->>A: PUT /api/progress/lesson/:id
    A->>A: Authenticate user
    A->>DB: Check course access
    A->>DB: Update lesson progress
    A->>DB: Calculate course progress
    A->>Cache: Update progress cache
    A->>Analytics: Track lesson_completed
    A->>C: Return updated progress
```

---

## ğŸ›¡ï¸ ARQUITECTURA DE SEGURIDAD

### Capas de Seguridad
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PERIMETER SECURITY                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   FIREWALL  â”‚ â”‚    DDoS     â”‚ â”‚  GEO-BLOCK  â”‚               â”‚
â”‚  â”‚             â”‚ â”‚ PROTECTION  â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ Port 443  â”‚ â”‚             â”‚ â”‚ â€¢ Whitelist â”‚               â”‚
â”‚  â”‚ â€¢ Port 80   â”‚ â”‚ â€¢ Rate Limitâ”‚ â”‚ â€¢ Blacklist â”‚               â”‚
â”‚  â”‚ â€¢ Port 22   â”‚ â”‚ â€¢ IP Filter â”‚ â”‚ â€¢ Suspiciousâ”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    APPLICATION SECURITY                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ RATE LIMITS â”‚ â”‚    INPUT     â”‚ â”‚    AUTH      â”‚               â”‚
â”‚  â”‚             â”‚ â”‚ VALIDATION  â”‚ â”‚              â”‚               â”‚
â”‚  â”‚ â€¢ API: 100/15mâ”‚ â”‚             â”‚ â”‚ â€¢ JWT       â”‚               â”‚
â”‚  â”‚ â€¢ Auth: 5/15m â”‚ â”‚ â€¢ Joi Schemaâ”‚ â”‚ â€¢ 2FA       â”‚               â”‚
â”‚  â”‚ â€¢ Pay: 3/5m  â”‚ â”‚ â€¢ Sanitize  â”‚ â”‚ â€¢ RBAC      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      DATA SECURITY                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ENCRYPTION  â”‚ â”‚   HASHING   â”‚ â”‚  DATABASE   â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  SECURITY   â”‚               â”‚
â”‚  â”‚ â€¢ TLS 1.3   â”‚ â”‚ â€¢ bcrypt    â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ AES-256   â”‚ â”‚ â€¢ Passwords â”‚ â”‚ â€¢ AuthN     â”‚               â”‚
â”‚  â”‚ â€¢ At Rest   â”‚ â”‚ â€¢ Sensitive â”‚ â”‚ â€¢ AuthZ     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š MODELO DE DATOS

### Esquema de Base de Datos
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USERS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: ObjectId                                                   â”‚
â”‚ email: String (unique, indexed)                                 â”‚
â”‚ username: String (unique)                                       â”‚
â”‚ password: String (hashed)                                       â”‚
â”‚ firstName: String                                               â”‚
â”‚ lastName: String                                                â”‚
â”‚ role: Enum [student, teacher, admin]                           â”‚
â”‚ isEmailVerified: Boolean                                        â”‚
â”‚ twoFactorSecret: String                                         â”‚
â”‚ profileImage: String                                            â”‚
â”‚ preferences: Object                                             â”‚
â”‚ lastLoginAt: Date                                               â”‚
â”‚ createdAt: Date                                                 â”‚
â”‚ updatedAt: Date                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1:N
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          COURSES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: ObjectId                                                   â”‚
â”‚ title: String                                                   â”‚
â”‚ slug: String (unique, indexed)                                  â”‚
â”‚ description: String                                             â”‚
â”‚ teacher: ObjectId â†’ Users                                       â”‚
â”‚ category: String (indexed)                                      â”‚
â”‚ level: Enum [beginner, intermediate, advanced] (indexed)       â”‚
â”‚ price: Number                                                   â”‚
â”‚ currency: String                                                â”‚
â”‚ isPublished: Boolean (indexed)                                  â”‚
â”‚ thumbnail: String                                               â”‚
â”‚ totalLessons: Number                                            â”‚
â”‚ estimatedDuration: Number                                       â”‚
â”‚ tags: [String]                                                  â”‚
â”‚ requirements: [String]                                          â”‚
â”‚ whatWillLearn: [String]                                         â”‚
â”‚ createdAt: Date (indexed)                                       â”‚
â”‚ updatedAt: Date                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                              â”‚
              â”‚ 1:N                          â”‚ 1:N
              â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        LESSONS           â”‚    â”‚       PURCHASES          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: ObjectId            â”‚    â”‚ _id: ObjectId            â”‚
â”‚ courseId: ObjectId       â”‚    â”‚ userId: ObjectId         â”‚
â”‚ title: String            â”‚    â”‚ courseId: ObjectId       â”‚
â”‚ content: String          â”‚    â”‚ amount: Number           â”‚
â”‚ videoUrl: String         â”‚    â”‚ currency: String         â”‚
â”‚ duration: Number         â”‚    â”‚ stripePaymentIntentId    â”‚
â”‚ order: Number            â”‚    â”‚ status: Enum             â”‚
â”‚ isPublished: Boolean     â”‚    â”‚ purchasedAt: Date        â”‚
â”‚ createdAt: Date          â”‚    â”‚                          â”‚
â”‚ updatedAt: Date          â”‚    â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                              â”‚
              â”‚ 1:N                          â”‚
              â–¼                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚       PROGRESS           â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚ _id: ObjectId            â”‚                 â”‚
â”‚ userId: ObjectId         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ courseId: ObjectId       â”‚
â”‚ lessonId: ObjectId       â”‚
â”‚ status: Enum             â”‚
â”‚ timeSpent: Number        â”‚
â”‚ completedAt: Date        â”‚
â”‚ createdAt: Date          â”‚
â”‚ updatedAt: Date          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ãndices de Base de Datos
```javascript
// Ãndices crÃ­ticos para performance
db.users.createIndex({ email: 1 }, { unique: true })
db.users.createIndex({ username: 1 }, { unique: true })
db.users.createIndex({ role: 1, createdAt: -1 })

db.courses.createIndex({ slug: 1 }, { unique: true })
db.courses.createIndex({ teacher: 1 })
db.courses.createIndex({ category: 1, level: 1 })
db.courses.createIndex({ isPublished: 1, createdAt: -1 })
db.courses.createIndex({ 
  title: "text", 
  description: "text", 
  tags: "text" 
})

db.purchases.createIndex({ userId: 1, courseId: 1 })
db.purchases.createIndex({ stripePaymentIntentId: 1 }, { unique: true })
db.purchases.createIndex({ status: 1, purchasedAt: -1 })

db.progress.createIndex({ userId: 1, lessonId: 1 }, { unique: true })
db.progress.createIndex({ userId: 1, courseId: 1 })
db.progress.createIndex({ courseId: 1, status: 1 })

// TTL para tokens expirados
db.refresh_tokens.createIndex({ expiresAt: 1 }, { expireAfterSeconds: 0 })
```

---

## ğŸ”„ PATRONES DE DISEÃ‘O

### Repository Pattern
```javascript
// Base Repository
class BaseRepository {
  constructor(model) {
    this.model = model;
  }

  async findById(id) {
    return await this.model.findById(id);
  }

  async findOne(query) {
    return await this.model.findOne(query);
  }

  async find(query, options = {}) {
    return await this.model.find(query, null, options);
  }

  async create(data) {
    return await this.model.create(data);
  }

  async update(id, data) {
    return await this.model.findByIdAndUpdate(id, data, { new: true });
  }

  async delete(id) {
    return await this.model.findByIdAndDelete(id);
  }
}

// Specific Repository
class UserRepository extends BaseRepository {
  constructor() {
    super(User);
  }

  async findByEmail(email) {
    return await this.model.findOne({ email });
  }

  async findActiveTeachers() {
    return await this.model.find({ 
      role: 'teacher', 
      isActive: true 
    });
  }
}
```

### Service Layer Pattern
```javascript
class UserService {
  constructor(userRepo, emailService) {
    this.userRepo = userRepo;
    this.emailService = emailService;
  }

  async registerUser(userData) {
    // ValidaciÃ³n
    await this.validateUserData(userData);
    
    // Hash password
    const hashedPassword = await bcrypt.hash(userData.password, 12);
    
    // Crear usuario
    const user = await this.userRepo.create({
      ...userData,
      password: hashedPassword
    });

    // Enviar email de confirmaciÃ³n
    await this.emailService.sendWelcomeEmail(user.email);

    return user;
  }

  async validateUserData(userData) {
    if (await this.userRepo.findByEmail(userData.email)) {
      throw new Error('Email already exists');
    }
  }
}
```

### Middleware Pattern
```javascript
// Authentication Middleware
const authMiddleware = (req, res, next) => {
  try {
    const token = req.cookies.accessToken || 
                  req.headers.authorization?.split(' ')[1];
    
    if (!token) {
      return res.status(401).json({ error: 'No token provided' });
    }

    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ error: 'Invalid token' });
  }
};

// Authorization Middleware
const authorize = (roles) => (req, res, next) => {
  if (!roles.includes(req.user.role)) {
    return res.status(403).json({ error: 'Insufficient permissions' });
  }
  next();
};
```

---

## ğŸ“ˆ ESCALABILIDAD

### Estrategias de Escalabilidad Horizontal
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LOAD BALANCER LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   NGINX     â”‚ â”‚ CLOUDFLARE  â”‚ â”‚   AWS ALB   â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ Round     â”‚ â”‚ â€¢ Global    â”‚ â”‚ â€¢ Health    â”‚               â”‚
â”‚  â”‚   Robin     â”‚ â”‚   CDN       â”‚ â”‚   Checks    â”‚               â”‚
â”‚  â”‚ â€¢ Health    â”‚ â”‚ â€¢ DDoS      â”‚ â”‚ â€¢ SSL       â”‚               â”‚
â”‚  â”‚   Check     â”‚ â”‚   Protectionâ”‚ â”‚   Offload   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   APPLICATION LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  NODE.JS    â”‚ â”‚  NODE.JS    â”‚ â”‚  NODE.JS    â”‚               â”‚
â”‚  â”‚ INSTANCE 1  â”‚ â”‚ INSTANCE 2  â”‚ â”‚ INSTANCE N  â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ Stateless â”‚ â”‚ â€¢ Stateless â”‚ â”‚ â€¢ Stateless â”‚               â”‚
â”‚  â”‚ â€¢ Auto-     â”‚ â”‚ â€¢ Auto-     â”‚ â”‚ â€¢ Auto-     â”‚               â”‚
â”‚  â”‚   Scale     â”‚ â”‚   Scale     â”‚ â”‚   Scale     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     DATA LAYER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   MONGODB   â”‚ â”‚    REDIS    â”‚ â”‚    CDN      â”‚               â”‚
â”‚  â”‚ REPLICA SET â”‚ â”‚   CLUSTER   â”‚ â”‚  (STATIC)   â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ Primary   â”‚ â”‚ â€¢ Session   â”‚ â”‚ â€¢ Images    â”‚               â”‚
â”‚  â”‚ â€¢ Secondary â”‚ â”‚ â€¢ Cache     â”‚ â”‚ â€¢ Videos    â”‚               â”‚
â”‚  â”‚ â€¢ Arbiter   â”‚ â”‚ â€¢ Pub/Sub   â”‚ â”‚ â€¢ CSS/JS    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Auto-scaling Configuration
```yaml
# Kubernetes Horizontal Pod Autoscaler
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: parnassus-api-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: parnassus-api
  minReplicas: 3
  maxReplicas: 20
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

---

## ğŸ” MONITOREO Y OBSERVABILIDAD

### Stack de Monitoreo
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       METRICS COLLECTION                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ APPLICATION â”‚ â”‚  SYSTEM     â”‚ â”‚  BUSINESS   â”‚               â”‚
â”‚  â”‚   METRICS   â”‚ â”‚  METRICS    â”‚ â”‚   METRICS   â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ Response  â”‚ â”‚ â€¢ CPU       â”‚ â”‚ â€¢ Users     â”‚               â”‚
â”‚  â”‚   Time      â”‚ â”‚ â€¢ Memory    â”‚ â”‚ â€¢ Courses   â”‚               â”‚
â”‚  â”‚ â€¢ Error     â”‚ â”‚ â€¢ Disk      â”‚ â”‚ â€¢ Revenue   â”‚               â”‚
â”‚  â”‚   Rate      â”‚ â”‚ â€¢ Network   â”‚ â”‚ â€¢ Engagementâ”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      LOGGING PIPELINE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   WINSTON   â”‚ â”‚ FILEBEAT/   â”‚ â”‚ ELASTICSEARCHâ”‚               â”‚
â”‚  â”‚   LOGGER    â”‚ â”‚  FLUENTD    â”‚ â”‚   CLUSTER    â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ Structuredâ”‚ â”‚ â€¢ Log       â”‚ â”‚ â€¢ Search    â”‚               â”‚
â”‚  â”‚   JSON      â”‚ â”‚   Shipping  â”‚ â”‚ â€¢ Analysis  â”‚               â”‚
â”‚  â”‚ â€¢ Multiple  â”‚ â”‚ â€¢ Parse     â”‚ â”‚ â€¢ Alerting  â”‚               â”‚
â”‚  â”‚   Levels    â”‚ â”‚ â€¢ Filter    â”‚ â”‚             â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ALERTING & DASHBOARD                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   GRAFANA   â”‚ â”‚ PROMETHEUS  â”‚ â”‚   ALERTMANAGERâ”‚               â”‚
â”‚  â”‚  DASHBOARD  â”‚ â”‚   ALERTS    â”‚ â”‚              â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚ â€¢ Slack      â”‚               â”‚
â”‚  â”‚ â€¢ Real-time â”‚ â”‚ â€¢ Threshold â”‚ â”‚ â€¢ Email      â”‚               â”‚
â”‚  â”‚ â€¢ Historicalâ”‚ â”‚ â€¢ Anomaly   â”‚ â”‚ â€¢ PagerDuty  â”‚               â”‚
â”‚  â”‚ â€¢ Custom    â”‚ â”‚ â€¢ SLA       â”‚ â”‚ â€¢ SMS        â”‚               â”‚
â”‚  â”‚   Views     â”‚ â”‚   Breach    â”‚ â”‚              â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ PERFORMANCE OPTIMIZATION

### Estrategias de Cache
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CACHE LAYERS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   BROWSER   â”‚ â”‚     CDN     â”‚ â”‚  NGINX      â”‚               â”‚
â”‚  â”‚    CACHE    â”‚ â”‚    CACHE    â”‚ â”‚   CACHE     â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ Local     â”‚ â”‚ â€¢ Global    â”‚ â”‚ â€¢ Static    â”‚               â”‚
â”‚  â”‚   Storage   â”‚ â”‚   Edge      â”‚ â”‚   Files     â”‚               â”‚
â”‚  â”‚ â€¢ Session   â”‚ â”‚ â€¢ Images    â”‚ â”‚ â€¢ Gzip      â”‚               â”‚
â”‚  â”‚   Storage   â”‚ â”‚ â€¢ Videos    â”‚ â”‚ â€¢ Headers   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ APPLICATION â”‚ â”‚    REDIS    â”‚ â”‚  DATABASE   â”‚               â”‚
â”‚  â”‚    CACHE    â”‚ â”‚    CACHE    â”‚ â”‚   CACHE     â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ Memory    â”‚ â”‚ â€¢ Session   â”‚ â”‚ â€¢ Query     â”‚               â”‚
â”‚  â”‚   Cache     â”‚ â”‚   Store     â”‚ â”‚   Cache     â”‚               â”‚
â”‚  â”‚ â€¢ Response  â”‚ â”‚ â€¢ User      â”‚ â”‚ â€¢ Index     â”‚               â”‚
â”‚  â”‚   Cache     â”‚ â”‚   Cache     â”‚ â”‚   Cache     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Query Optimization
```javascript
// AgregaciÃ³n optimizada para dashboard de administrador
const coursesAnalytics = await Course.aggregate([
  {
    $match: { 
      isPublished: true,
      createdAt: { $gte: startDate, $lte: endDate }
    }
  },
  {
    $lookup: {
      from: 'purchases',
      localField: '_id',
      foreignField: 'courseId',
      as: 'purchases'
    }
  },
  {
    $addFields: {
      totalSales: { $size: '$purchases' },
      revenue: { 
        $sum: '$purchases.amount' 
      }
    }
  },
  {
    $group: {
      _id: '$category',
      totalCourses: { $sum: 1 },
      totalSales: { $sum: '$totalSales' },
      totalRevenue: { $sum: '$revenue' },
      avgPrice: { $avg: '$price' }
    }
  },
  {
    $sort: { totalRevenue: -1 }
  }
]);

// Usar Ã­ndices compuestos para queries complejas
db.courses.createIndex({ 
  isPublished: 1, 
  category: 1, 
  createdAt: -1 
});
```

---

## ğŸ”„ CI/CD PIPELINE

### Pipeline Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SOURCE CONTROL                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                     GitHub Repository                           â”‚
â”‚                   (Feature Branches)                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ Push/PR
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTINUOUS INTEGRATION                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   LINTING   â”‚ â”‚   TESTING   â”‚ â”‚  SECURITY   â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚    SCAN     â”‚               â”‚
â”‚  â”‚ â€¢ ESLint    â”‚ â”‚ â€¢ Unit      â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ Prettier  â”‚ â”‚ â€¢ Integrationâ”‚ â”‚ â€¢ SAST      â”‚               â”‚
â”‚  â”‚ â€¢ Standards â”‚ â”‚ â€¢ E2E       â”‚ â”‚ â€¢ Deps      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ Tests Pass
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CONTINUOUS DEPLOYMENT                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   BUILD     â”‚ â”‚   DEPLOY    â”‚ â”‚  MONITOR    â”‚               â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚               â”‚
â”‚  â”‚ â€¢ Docker    â”‚ â”‚ â€¢ Staging   â”‚ â”‚ â€¢ Health    â”‚               â”‚
â”‚  â”‚   Image     â”‚ â”‚ â€¢ Blue/     â”‚ â”‚   Check     â”‚               â”‚
â”‚  â”‚ â€¢ Push      â”‚ â”‚   Green     â”‚ â”‚ â€¢ Rollback  â”‚               â”‚
â”‚  â”‚   Registry  â”‚ â”‚ â€¢ Productionâ”‚ â”‚ â€¢ Alerts    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**DocumentaciÃ³n de Arquitectura**: VersiÃ³n 3.0
**Ãšltima actualizaciÃ³n**: 14 de Agosto 2025
**Compatibilidad**: Node.js 18+, MongoDB 5+, ES2022
